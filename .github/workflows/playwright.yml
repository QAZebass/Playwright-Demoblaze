name: Run Playwright Demoblaze Tests ðŸ“ˆ

on:
  push:
    branches:
      - Playwright-Demoblaze
      - main 


jobs:
  run-tests:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [20]

    steps:
      - name: Checkout ðŸ’¿
        uses: actions/checkout@v4.1.4

      - name: Set up Node.js ðŸ“€
        uses: actions/setup-node@v4.0.2
        with:
          node-version: ${{ matrix.node-version }}

      - name: Install Yarn ðŸ’½
        run: npm install -g yarn@latest

      - name: Install Playwright dependencies 
        run: yarn install
          
      - name: Install Playwright browsers and libraries ðŸŒ
        run: yarn playwright install --with-deps
  
      - name: Install XVFB
        run: sudo apt-get install xvfb 
        
      - name: Setup Environment for Demoblaze Tests ðŸš€
        run: |
          echo "USER_NAME=${{ secrets.USER_NAME }}" >> $GITHUB_ENV
          echo "PASSWORD=${{ secrets.PASSWORD }}" >> $GITHUB_ENV


      - name: Run tests for Demoblaze ðŸ§©
        run: |
          cd ./e2e/specs
          yarn install
          xvfb-run yarn test
    

      - name: Install Demoblaze artifact ðŸ“Š   
        uses: actions/upload-artifact@v4.3.3
        with:
            name: playwright-report 
            path: playwright-report/ 
            retention-days: 30 
            overwrite: true

  